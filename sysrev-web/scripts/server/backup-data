#!/bin/bash
set -eu

host=$(hostname)
backup_dir=/data/sysrev/backups
date_string=$(date +%F_%H-%M-%S)
fname="sysrev-${date_string}.pgdumpc"
options="-T article_similarity -T schema_version"

cd "$backup_dir"
pg_dump -U postgres -Fc $options sysrev > "$fname"
echo "$host: saved backup to $fname"
scp -i $HOME/.ssh/id_rsa.insilica ./"$fname" insilica@insilica-ws-1.ddns.net:/data/backups/"$host"/"$fname" || true
